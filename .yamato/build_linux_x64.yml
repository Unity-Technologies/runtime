{% metadata_file .yamato/Globals.metafile %}
---
name: Build Linux x64

agent:
  type: Unity::VM
  image: platform-foundation/linux-ubuntu-18.04-mono-bokken:0.1.7-978398
  flavor: b1.large

variables:
  ARTIFACT_FILENAME: {{globals.artifact_base_name}}-linux-x64.7z

commands:
  - mkdir artifacts
  - curl https://public-stevedore.unity3d.com/r/public/7za-linux-x64/e6c75fb7ffda_e6a295cdcae3f74d315361883cf53f75141be2e739c020035f414a449d4876af.zip --output artifacts/7za-linux-x64.zip
  - unzip artifacts/7za-linux-x64.zip -d artifacts/7za-linux-x64
  - ./build.sh -subset clr+libs+libs -a x64 -c release -ci -ninja
  - ./unity/do-unity-build-steps
  - artifacts/7za-linux-x64/7za a artifacts/unity/$ARTIFACT_FILENAME ./artifacts/bin/microsoft.netcore.app.runtime.linux-x64/Release/runtimes/linux-x64/*

artifacts:
  7z-archives:
    paths:
      - artifacts/unity/**
  build:
    paths:
      - artifacts/bin/**
